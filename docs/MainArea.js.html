<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: MainArea.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: MainArea.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { Component } from 'react';
import './App.css';
import ContainerPage from './ContainerPage.js';
import ProfilePage from './ProfilePage.js';
import ImagePage from './ImagePage.js';
import HostPage from './HostPage.js';
import MonitoringPage from './MonitoringPage.js';
import LogPage from './LogPage.js';
import { Well, Grid, Col } from 'react-bootstrap';
import { Route, Redirect } from 'react-router-dom';

/**
 * Renders loading view component.
 * @returns {jsx} component html code
 */
const LoadingView = () =>
  &lt;Well bsSize="small" className="Console">
    Loading...
  &lt;/Well>

/**
 * Renders error view component.
 * @param {props} props contains error message
 * @returns {jsx} component html code
 */
const ErrorView = props =>
  &lt;Well bsSize="small" className="Console">
    {props.msg}
  &lt;/Well>

/**
 * Main area UI component
 */
class MainArea extends Component {
  constructor(props) {
    super();
    this.state = {
      loading: false,
      error: false,
      containers: [],
      containerStates: [],
      hosts: [],
      profiles: [],
      images: []
    };
  }


  /**
   * Http request method.
   * @param {string} method http method
   * @param {string} path url path
   * @param {string} body http method body
   * @param {function} callBackfunction callback function to be called with http response body as argument
   */
  httpRequest = (method, path, body, callbackFunction) => {
    this.setState({
      loading: true
    });
    fetch(this.props.apiUrl + path, {
      method: method,
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${this.props.accessToken}`
      },
      body: body
    })
    .then(response => {
      console.log('Request response: ', response);
      if (response.status === 401) {
        this.props.logout();  // TODO try using refresh token before logging out
        Promise.reject();
      };
      const obj = {};
      obj.httpStatus = response.status;

      const contentType = response.headers.get('content-type');
      obj.isJson = (contentType &amp;&amp; contentType.includes('application/json'));

      if (obj.isJson) {
        return response.json().then(json => {
          obj.jsonData = json;
          return obj;
        })
      }
      return obj;
    })
    .then(obj => {
      if (obj.jsonData)
        obj.jsonIsArray = (obj.jsonData instanceof Array) ? true : false;

      console.log('Request response JSON data: ', obj.jsonData);

      if (obj.jsonIsArray)
        obj.jsonArrayIsEmpty = (obj.jsonData.length === 0) ? true : false;

      callbackFunction(obj);
    })
    .then(() => {
      this.setState({
        loading: false,
        error: false
      });
    })
    .catch(error => {
      console.log('Request failed: ', error.message);
      this.setState({
        loading: false,
        error: error
      });
    });
  }


  /** Shows the current loading status */
  showStatus = () => {
    if (this.state.loading)
      return &lt;LoadingView />;
    else if (this.state.error)
      return &lt;ErrorView msg="Error loading. Try refreshing."/>;
  }


  /** Compares two object's names. To be used in Array.sort method */
  compareName = (a, b) => {
    if (a.name &lt; b.name)
      return -1;
    if (a.name > b.name)
      return 1;
    return 0;
  }

  /** Gets containers */
  httpGetContainers = () => {
    this.httpRequest('GET', 'containers', null, obj => {
      // if (!obj.jsonArrayIsEmpty) obj.jsonData.sort(this.compareName);  // TODO
      if (obj.httpStatus !== 200) return;
      obj.jsonData.sort(this.compareName);
      this.setState({ containers: obj.jsonData });
    });
  }

  /** Gets container state */
  httpGetContainerState = id => {
    this.httpRequest('GET', `containers/${id}/state`, null, obj => {
      if (obj.httpStatus !== 200) return;
      const containerStates = this.state.containerStates;
      containerStates[id] = obj.jsonData.metadata.status;
      this.setState({ containerStates: containerStates });
    });
  }

  /** Puts container state */
  httpPutContainerState = (id, action) => {
    const body = JSON.stringify({
      action: action
    });
    this.httpRequest('PUT', `containers/${id}/state`, body, () => {
      this.httpGetContainers();
    })
  }

  /** Gets hosts */
  httpGetHosts = () => {
    this.httpRequest('GET', 'hosts', null, obj => {
      if (obj.httpStatus !== 200) return;
      obj.jsonData.sort(this.compareName);
      this.setState({ hosts: obj.jsonData });
    })
  }

  /** Gets profiles */
  httpGetProfiles = () => {
    this.httpRequest('GET', 'profiles', null, obj => {
      if (obj.httpStatus !== 200) return;
      obj.jsonData.sort(this.compareName);
      this.setState({ profiles: obj.jsonData });
    })
  }

  /** Gets images */
  httpGetImages = () => {
    this.httpRequest('GET', 'images', null, obj => {
      if (obj.httpStatus !== 200) return;
      // obj.jsonData.sort(this.compareName);
      this.setState({ images: obj.jsonData });
    })
  }

  /**
   * Renders the component.
   * @returns {jsx} component html code
   */
  render() {
    return (
      &lt;div>
        &lt;Route exact path="/" render={() => &lt;Redirect to="/containers" />} />
        &lt;Route
          path="/containers"
          render={() => &lt;ContainerPage
                          error={this.state.error}
                          httpRequest={this.httpRequest}
                          httpGetHosts={this.httpGetHosts}
                          hosts={this.state.hosts}
                          httpGetContainers={this.httpGetContainers}
                          httpPutContainerState={this.httpPutContainerState}
                          containers={this.state.containers}
                          containerStates={this.props.containerStates}
                          httpGetProfiles={this.httpGetProfiles}
                          profiles={this.state.profiles}
                          httpGetImages={this.httpGetImages}
                          images={this.state.images}
                        />}
        />
        &lt;Route
          path="/profiles"
          render={() => &lt;ProfilePage
                          error={this.state.error}
                          httpRequest={this.httpRequest}
                          httpGetProfiles={this.httpGetProfiles}
                          profiles={this.state.profiles}
                        />}
        />
        &lt;Route
          path="/images"
          render={() => &lt;ImagePage
                          error={this.state.error}
                          httpRequest={this.httpRequest}
                          hosts={this.state.hosts}
                          httpGetHosts={this.httpGetHosts}
                          httpGetImages={this.httpGetImages}
                          images={this.state.images}
                          httpGetContainers={this.httpGetContainers}
                          containers={this.state.containers}
                        />}
        />
        &lt;Route
          path="/hosts"
          render={() => &lt;HostPage
                          error={this.state.error}
                          httpRequest={this.httpRequest}
                          httpGetHosts={this.httpGetHosts}
                          hosts={this.state.hosts}
                        />}
        />
        &lt;Route
          path="/monitoring"
          render={() => &lt;MonitoringPage
                          httpGetHosts={this.httpGetHosts}
                          hosts={this.state.hosts}
                          httpGetContainers={this.httpGetContainers}
                          containers={this.state.containers}
                          httpRequest={this.httpRequest}
                        />}
        />
        &lt;Route
          path="/logs"
          render={() => &lt;LogPage
                          apiUrl={this.props.apiUrl}
                          accessToken={this.props.accessToken}
                          error={this.state.error}
                          httpRequest={this.httpRequest}
                          httpGetContainers={this.httpGetContainers}
                          containers={this.state.containers}
                        />}
        />
        &lt;Route
          path="/backup"
          render={() => &lt;div>&lt;/div>}
        />
        &lt;Grid>
          &lt;Col xs={9} xsOffset={3} md={10} mdOffset={2}>
            {this.showStatus()}
          &lt;/Col>
        &lt;/Grid>
      &lt;/div>
    )
  }
}

export default MainArea;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="App.html">App</a></li><li><a href="ContainerCreate.html">ContainerCreate</a></li><li><a href="ContainerEdit.html">ContainerEdit</a></li><li><a href="ContainerOverview.html">ContainerOverview</a></li><li><a href="ContainerPage.html">ContainerPage</a></li><li><a href="ContainerShow.html">ContainerShow</a></li><li><a href="HostAuthorize.html">HostAuthorize</a></li><li><a href="HostCreate.html">HostCreate</a></li><li><a href="HostEdit.html">HostEdit</a></li><li><a href="HostOverview.html">HostOverview</a></li><li><a href="HostPage.html">HostPage</a></li><li><a href="HostShow.html">HostShow</a></li><li><a href="ImageCreate.html">ImageCreate</a></li><li><a href="ImageEdit.html">ImageEdit</a></li><li><a href="ImageOverview.html">ImageOverview</a></li><li><a href="ImagePage.html">ImagePage</a></li><li><a href="ImageShow.html">ImageShow</a></li><li><a href="LogPage.html">LogPage</a></li><li><a href="LogShow.html">LogShow</a></li><li><a href="MainArea.html">MainArea</a></li><li><a href="MonitoringPage.html">MonitoringPage</a></li><li><a href="MonitoringShow.html">MonitoringShow</a></li><li><a href="Navigation.html">Navigation</a></li><li><a href="ProfileCreate.html">ProfileCreate</a></li><li><a href="ProfileEdit.html">ProfileEdit</a></li><li><a href="ProfileOverview.html">ProfileOverview</a></li><li><a href="ProfilePage.html">ProfilePage</a></li><li><a href="ProfileShow.html">ProfileShow</a></li><li><a href="Sidebar.html">Sidebar</a></li></ul><h3>Global</h3><ul><li><a href="global.html#ErrorView">ErrorView</a></li><li><a href="global.html#LoadingView">LoadingView</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Jan 23 2018 19:33:08 GMT+0100 (CET)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
